---
import {Image} from 'astro:assets';
import {getCollection} from 'astro:content';
import FormattedDate from '../../components/FormattedDate.astro';
import {SITE_DESCRIPTION, SITE_TITLE} from '../../consts';
import BaseLayout from '../../layouts/BlogPost.astro';

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<BaseLayout
    title={`Blog - ${SITE_TITLE}`}
    description={SITE_DESCRIPTION}
    pubDate={new Date()}
    updatedDate={new Date()}
>
  <section class="mx-auto p-4">
    <ul class="mx-auto container md:columns-2 xl:columns-3 gap-4 md:gap-6 xl:gap-8 list-none m-0 p-0">
      {
        posts.map((post) => (
            <li
                data-aos-once="false"
                data-aos="fade-up"
                data-aos-offset="120"
                data-aos-duration="500"
                data-aos-easing="ease-in-out"
                class="group @container h-full pb-4 md:pb-6 xl:pb-8 break-inside-avoid"
            >
              <div class="bg-linear-to-r group-odd:bg-linear-to-l from-primary/30 to-primary/10 text-secondary
                 transition-all ease-in-out delay-50 duration-400 hover:to-primary/70
                 inset-shadow-2xs hover:inset-shadow-sm
                 hover:scale-[1.01] hover:inset-shadow-lg inset-shadow-background
                 bg-blur-lg hover:shadow-lg shadow-primary/30
                 w-full p-4 md:p-6 xl:p-8 rounded-2xl">
                <a href={`/blog/${post.id}/`}
                   class="hover:cursor-pointer flex flex-col gap-4 md:gap-6 xl:gap-8 w-full">
                  {post.data.heroImage && (
                      <div class="inset-shadow-2xs group-hover:inset-shadow-primary inset-shadow-secondary w-full z-10 rounded-xl">
                        <Image
                            loading={"eager"}
                            src={post.data.heroImage} alt={post.data.title}
                            class="rounded-xl w-full  aspect-video "/>
                      </div>
                  )}
                  <div class="flex flex-col flex-1 gap-2 justify-between">
                    <div class="flex flex-col">
                      <h2 class="text-xl lg:text-2xl xl:text-3xl font-bold font-serif">{post.data.title}</h2>
                      <p class="text-xs lg:text-sm xl:text-md">
                        <FormattedDate date={post.data.pubDate}/>
                      </p>
                      <p class="text-md lg:text-lg xl:text-xl py-8">{post.data.preview}</p>
                    </div>

                    <div class="flex flex-wrap gap-2 mt-4">
                      {post.data.tags?.map(t => (
                          <span
                              class="inline-block bg-secondary/20 text-secondary px-3 py-1 rounded-full text-sm lg:text-md font-mono w-fit">
                          #{t}
                        </span>
                      ))}
                    </div>
                  </div>
                </a>
              </div>
            </li>
        ))
      }
    </ul>
  </section>
</BaseLayout>

