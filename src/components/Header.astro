---
import {SITE_TITLE} from '../consts';
import HeaderLink from './HeaderLink.astro';
---

<header id="header" class="sticky top-2 z-20 m-2 transition-all duration-300 ease-in-out [&>*>div]:inset-shadow-secondary-foreground">
  <nav class="flex flex-row w-full justify-between items-center">
    <div data-aos="fade-right"
         data-aos-delay="100"
         data-aos-once="true"
         class="flex flex-row p-2 gap-1 rounded-2xl bg-primary/80 text-secondary inset-shadow-sm"
    >
      <HeaderLink class={"text-lg"} emoji='ðŸ ' href="/">Home</HeaderLink>
      <HeaderLink class={"text-lg"} emoji='ðŸ‘©ðŸ»â€ðŸ’»' href="/blog">Blog</HeaderLink>
      <HeaderLink class={"text-lg"} emoji='ðŸ“šï¸' href="/books">Books</HeaderLink>
      <HeaderLink class={"text-lg"} emoji='ðŸ‘©ðŸ»â€âš•ï¸' href="/about">About Me</HeaderLink>
    </div>
    <a
        data-aos="fade-left"
        data-aos-delay="100"
        class="align-middle font-serif" href="/">
      <h2
          class="align-middle h-fit py-2 px-4 rounded-4xl text-lg inset-shadow-sm bg-secondary text-primary-foreground"
      >
        {SITE_TITLE}
      </h2>
    </a>
  </nav>
</header>

<script>
  // Observe the header element for intersection
  function onScroll(_: Event) {
    const header = document.getElementById("header");
    const main = document.getElementById("main");
    const headerRect = header!.getBoundingClientRect();
    const mainRect = main!.getBoundingClientRect();

    const overlap = !(
      headerRect.bottom < mainRect.top ||
      headerRect.top > mainRect.bottom
    );

    if (overlap) {
      header!.classList.add(
        "backdrop-blur-lg",
        "bg-primary/60",
        "p-2",
        "rounded-2xl",
        "inset-shadow-sm",
        "inset-shadow-primary-foreground",
        "[&>*>div]:inset-shadow-primary",
        "[&>*>a]:inset-shadow-primary"
      );
      header!.classList.remove(
        "bg-transparent",
        "[&>*>div]:inset-shadow-secondary-foreground",
        "[&>*>a]:inset-shadow-secondary-foreground"
      );
    } else {
      header!.classList.remove(
        "backdrop-blur-lg",
        "bg-primary/60",
        "p-2",
        "rounded-2xl",
        "inset-shadow-sm",
        "inset-shadow-primary-foreground",
        "[&>*>div]:inset-shadow-primary",
        "[&>*>a]:inset-shadow-primary"
      );
      header!.classList.add(
        "bg-transparent",
        "[&>*>div]:inset-shadow-secondary-foreground",
        "[&>*>a]:inset-shadow-secondary-foreground"
      );
    }
  }

  window.addEventListener("scroll", onScroll);
</script>